(function(e){function t(t){for(var i,n,s=t[0],o=t[1],c=t[2],p=0,d=[];p<s.length;p++)n=s[p],r[n]&&d.push(r[n][0]),r[n]=0;for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i]);u&&u(t);while(d.length)d.shift()();return l.push.apply(l,c||[]),a()}function a(){for(var e,t=0;t<l.length;t++){for(var a=l[t],i=!0,s=1;s<a.length;s++){var o=a[s];0!==r[o]&&(i=!1)}i&&(l.splice(t--,1),e=n(n.s=a[0]))}return e}var i={},r={1:0},l=[];function n(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=i,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],o=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=o;l.push([3,0]),a()})({3:function(e,t,a){e.exports=a("Vtdi")},EDI0:function(e,t,a){},OVPu:function(e,t,a){},Vtdi:function(e,t,a){"use strict";a.r(t);a("VRzm");var i=a("Kw5r"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("water-mark")],1)},l=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"photo-mark-wrap"}},[a("h2",{staticClass:"page-title"},[e._v("给照片加上水印")]),a("div",{staticClass:"action"},[a("div",{staticClass:"item-wrap input"},[a("span",{staticClass:"item-label"},[e._v("水印文字：")]),a("el-input",{attrs:{placeholder:"请输入水印文字",maxlength:"15"},on:{change:e.updateWaterMark},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),a("el-button",{attrs:{type:"primary",disabled:!e.imgUrl},on:{click:e.generateFile}},[e._v("下载图片")])],1),a("div",{staticClass:"optional-attrs"},[a("div",{staticClass:"item-wrap"},[a("span",{staticClass:"item-label"},[e._v("字体大小：")]),a("el-select",{attrs:{placeholder:"请选择透明度"},on:{change:e.updateWaterMark},model:{value:e.fontSize,callback:function(t){e.fontSize=t},expression:"fontSize"}},e._l(e.fontSizeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label+"px",value:e.value}})}))],1),a("div",{staticClass:"item-wrap"},[a("span",{staticClass:"item-label"},[e._v("旋转角度：")]),a("el-select",{attrs:{placeholder:"请选择透明度"},on:{change:e.updateWaterMark},model:{value:e.degree,callback:function(t){e.degree=t},expression:"degree"}},e._l(e.degreeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label+"度",value:e.value}})}))],1),a("div",{staticClass:"item-wrap slider"},[a("span",{staticClass:"item-label"},[e._v("不透明度：")]),a("el-slider",{attrs:{step:10},on:{change:e.updateWaterMark},model:{value:e.opacity,callback:function(t){e.opacity=t},expression:"opacity"}}),a("span",{staticClass:"item-extra"},[e._v(e._s(e.opacity+"%"))])],1)]),a("input",{ref:"uploadBtn",staticClass:"hide",attrs:{type:"file",accept:".jpg, .jpeg, .png"},on:{change:e.upload}})]),a("div",{staticClass:"result"},[a("div",{staticClass:"image-wrap",style:{width:e.imgUrl?"auto":"400px",height:e.imgUrl?"auto":"400px"},on:{click:e.chooseFile}},[a("canvas",{directives:[{name:"show",rawName:"v-show",value:e.imgUrl,expression:"imgUrl"}],ref:"waterMark",staticClass:"water-mark",attrs:{width:"400",height:"400"}}),e.imgUrl?e._e():a("i",{staticClass:"el-icon-plus"}),e.imgUrl?a("i",{staticClass:"el-icon-close",on:{click:function(t){return t.stopPropagation(),e.removeFile(t)}}}):e._e(),e.imgUrl?a("img",{ref:"image",attrs:{src:e.imgUrl,alt:"图片"}}):e._e()])]),a("canvas",{ref:"sampleMark",staticClass:"hide",attrs:{width:"350",height:"150"}}),a("canvas",{ref:"downloadCanvas",staticClass:"hide",attrs:{width:"400",height:"400"}})])},s=[],o=(a("Z2Ku"),a("L9s1"),a("NO8f"),a("KKXr"),{name:"photo-mark",methods:{chooseFile:function(){this.imgUrl||this.$refs.uploadBtn.click()},removeFile:function(){this.imgUrl=""},generateFile:function(){this._drawMarkedImage();var e=this.$refs.downloadCanvas.toDataURL("image/png"),t=this._base64toBlob(e);window.open(URL.createObjectURL(t))},_base64toBlob:function(e){for(var t=e.split(";base64,"),a=t[0].split(":")[1],i=window.atob(t[1]),r=i.length,l=new Uint8Array(r),n=0;n<r;++n)l[n]=i.charCodeAt(n);return new Blob([l],{type:a})},_drawMarkedImage:function(){var e=this._getCanvas(this.$refs.downloadCanvas),t=e.dom,a=e.ctx;t.width=this.$refs.waterMark.width,t.height=this.$refs.waterMark.height,a.drawImage(this.$refs.image,0,0),a.drawImage(this.$refs.waterMark,0,0)},_fileReader:function(e,t){var a=new FileReader;a.onload=function(e){t(e.target.result)},a.readAsDataURL(e)},_getCanvas:function(e){var t=e||this.$refs.waterMark,a=t.getContext("2d");return{dom:t,ctx:a}},createMarkPattern:function(){var e=this._getCanvas(this.$refs.sampleMark),t=e.dom,a=e.ctx,i=this.degree*Math.PI/180;a.save(),a.clearRect(0,0,t.width,t.height),a.font="".concat(this.fontSize||20,"px 黑体"),a.rotate("-".concat(i)),a.fillStyle="rgba(100, 100, 100, ".concat(this.opacity/100,")"),a.fillText(this.text,0,30+4*this.degree),a.restore()},fillMarkPatterns:function(){var e=this._getCanvas(this.$refs.waterMark),t=e.dom,a=e.ctx,i=this.$refs.image;if(!this.imgUrl||this.loadImageRetryTime>=100)this.loadImageRetryTime=0;else{if(!i||0===i.width&&this.loadImageRetryTime<10)return this.loadImageRetryTime++,setTimeout(this.fillMarkPatterns,100);this.loadImageRetryTime=0,t.width=i.width,t.height=i.height,t.style.left=i.offsetLeft+"px",t.style.top=i.offsetTop+"px",a.clearRect(0,0,t.width,t.height),a.fillStyle=a.createPattern(this.$refs.sampleMark,"repeat"),a.fillRect(0,0,t.width,t.height)}},updateWaterMark:function(){this.createMarkPattern(),this.fillMarkPatterns()},upload:function(){var e=this,t=this.$refs.uploadBtn,a=t.files[0];t.value?this.ALLOW_UPLOAD_TYPE.includes(a.type)?this._fileReader(a,function(t){e.imgUrl=t,e.$nextTick(function(){e.updateWaterMark()})}):this.$message({message:"仅支持 jpg, jpeg, png, gif 图片格式",type:"warning"}):this.$message({message:"未选择文件",type:"warning"})}},data:function(){return{imgUrl:"",text:"",ALLOW_UPLOAD_TYPE:["image/png","image/jpeg","image/jpg","image/gif"],loadImageRetryTime:0,degree:20,degreeOptions:[{value:5,label:5},{value:10,label:10},{value:15,label:15},{value:20,label:20},{value:25,label:25},{value:30,label:30}],fontSize:18,fontSizeOptions:[{value:10,label:10},{value:12,label:12},{value:14,label:14},{value:18,label:18},{value:24,label:24},{value:36,label:36}],opacity:40}}}),c=o,u=(a("Z2Oy"),a("KHd+")),p=Object(u["a"])(c,n,s,!1,null,"51986b2a",null),d=p.exports,f={name:"app",components:{WaterMark:d}},h=f,g=(a("ZL7j"),Object(u["a"])(h,r,l,!1,null,null,null)),m=g.exports,v=a("XJYT"),w=a.n(v);a("D66Q");i["default"].config.productionTip=!1,i["default"].use(w.a),new i["default"]({render:function(e){return e(m)}}).$mount("#app")},Z2Oy:function(e,t,a){"use strict";var i=a("OVPu"),r=a.n(i);r.a},ZL7j:function(e,t,a){"use strict";var i=a("EDI0"),r=a.n(i);r.a}});
//# sourceMappingURL=app.fce699a5.js.map